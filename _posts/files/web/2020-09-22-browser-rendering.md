---
layout: post
title: 스크롤이벤트성능과 passive옵션
categories: Web
---

스크롤이벤트성능문제를 해결하는 방안으로 `{passive:true}`옵션설정에 대한 가이드가 있습니다. 스크롤이벤트의 성능과 해당 옵션은 어떤 관계가 있는지 알아봅니다.

## addEventListener

자바스크립트에서 스크롤 이벤트를 등록하기 위해서는 window객체에 스크롤이벤트를 등록하는 메서드인 addEventListener()를 호출해야 합니다. 메서드에는 핸들러를 등록하여 이벤트 발생시마다 호출되는 콜백을 지정할 수 있습니다.

참고) 이벤트의 타겟(EventTarget)의 addEventListener() 메서드는 지정한 이벤트가 대상에 전달될 때마다 호출할 함수를 설정하여 이벤트를 등록할 수 있습니다.일반적인 대상은 Element, Document, Window있고, XMLHttpRequest와 같이 이벤트를 지원하는 모든 객체를 대상으로 지정할 수도 있습니다.


## 렌더링 과정과 이벤트 핸들러의 동작
렌더링에 필요한 다섯 가지 주요 영역이 있습니다. 

- JS / CSS > 스타일 > [레이아웃] > [페인트] > [합성](Compositing)

### 렌더링 과정

#### 레이아웃
브라우저가 요소에 어떤 규칙을 적용할지 알게 되면 화면에서 얼마의 공간을 차지하고 어디에 배치되는지 계산하기 시작할 수 있습니다. 웹의 레이아웃 모델은 한 요소가 다른 요소에 영향을 줄 수 있음을 의미합니다. 예를 들어, <body> 요소의 너비는 일반적으로 하위 요소의 너비 등 트리의 위아래 모든 곳에 영향을 주며, 따라서 이 프로세스는 브라우저에 상당한 영향을 줄 수 있습니다.

#### 페인트 
페인트는 픽셀을 채우는 프로세스입니다. 이는 텍스트, 색, 이미지, 경계 및 그림자 등 요소의 모든 시각적 부분을 그리는 작업을 포함합니다. 그리기는 일반적으로 레이어라고 하는 다수의 표면에서 수행됩니다.

#### 합성(Compositing)
페이지의 여러 부분이 잠재적으로 여러 레이어로 그려졌기 때문에 페이지가 정확히 렌더링되려면 정확한 순서로 화면에 그려야 합니다. 실수로 한 요소가 다른 요소 위에 잘못 나타날 수 있기 때문에 이는 다른 요소와 겹치는 요소가 있는 경우에 특히 중요합니다.

### 렌더링과정의 생략이 가능한 경우
렌더링 과정이 생략된다는 것은 바로 브라우저가 해야 하는 일이 줄어들고, 이는 성능을 개선할 수 있음을 의미합니다. 즉, 수명 주기에서 애니메이션이나 스크롤처럼 많은 부담을 주는 시점에 가장 이상적이고 비용이 가장 적게 드는 과정을 통해 성능을 개선할 수 있습니다.

고성능 애니메이션에 빠른 트랙을 원하는 경우 컴포지터(compositor) 전용 속성을 변경하여 렌더링 과정을 최소화 할 수 있습니다.

참고) https://developers.google.com/web/fundamentals/performance/rendering/stick-to-compositor-only-properties-and-manage-layer-count?hl=ko

#### JS / CSS > 스타일 > 페인트 > 합성
페이지의 레이아웃에 영향을 주지 않는 배경 이미지, 텍스트 색상 또는 그림자 등의 'paint only' 속성을 변경하면, 브라우저가 레이아웃을 건너뛰되 페인트 작업은 여전히 수행합니다.
#### JS / CSS > 스타일 > 합성
레이아웃과 페인트가 필요 없는 속성을 변경하면 브라우저가 합성 단계로 건너뜁니다.




### 핸들러의 동작

window에 scroll이벤트를 포함하여 이벤트 핸들러가 등록되는 경우, 핸들러의 동작은 렌더링 되는 과정에서의 합성을 담당하는 브라우저의 컴포지터 스레드가 받게 됩니다. 즉! 

---

해당 내용은 다음 글을 참고 하였습니다.

- https://amati.io/eventlisteneroptions-passive-true/
- https://developers.google.com/web/fundamentals/performance/rendering?hl=ko#1_js_css_%EC%8A%A4%ED%83%80%EC%9D%BC_%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83_%ED%8E%98%EC%9D%B8%ED%8A%B8_%ED%95%A9%EC%84%B1
