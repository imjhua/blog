---
layout: post
title: 스크롤이벤트성능과 passive옵션
categories: Web
---

스크롤이벤트성능문제를 해결하는 방안으로 `{passive:true}`옵션설정에 대한 가이드가 있습니다. 스크롤이벤트의 성능과 해당 옵션은 어떤 관계가 있는지 알아봅니다.

## addEventListener

자바스크립트에서 스크롤 이벤트를 등록하기 위해서는 window객체에 스크롤이벤트를 등록하는 메서드인 addEventListener()를 호출해야 합니다. 메서드에는 핸들러를 등록하여 이벤트 발생시마다 호출되는 콜백을 지정할 수 있습니다.

참고) 이벤트의 타겟(EventTarget)의 addEventListener() 메서드는 지정한 이벤트가 대상에 전달될 때마다 호출할 함수를 설정하여 이벤트를 등록할 수 있습니다.일반적인 대상은 Element, Document, Window있고, XMLHttpRequest와 같이 이벤트를 지원하는 모든 객체를 대상으로 지정할 수도 있습니다.

## 렌더러 프로세스
브라우저 내부에는 웹콘텐츠를 담당하는 렌더러 프로세스가 존재합니다. 컨텐츠를 담당하기 위해 브라우저 탭 내부에서 발생하는 모든 작업을 담당하는 프로세스입니다. 렌더러 프로세스의 주요 역할은 HTML과 CSS, JavaScript를 사용자와 상호작용을 할 수 있는 웹 페이지로 변환하는 것입니다.

### 메인 스레드

브라우저로 전송된 대부분의 코드를 처리합니다. 웹 페이지를 효율적이고 부드럽게 렌더링하기 위해 별도의 컴포지터 스레드와 래스터 스레드가 렌더러 프로세스에서 실행됩니다.

참고) 간혹 웹 워커나 서비스 워커를 사용하는 경우에는 워커 스레드가 JavaScript 코드의 일부를 처리하기도 한다.

### 컴포지터 스레드 
병렬처리 담당

이 컴포지터 스레드는 GPU에서 발생한 합성 작업의 관리자가 되었습니다. 자바스크립트 실행과 같이 메인 스레드가 무언가를 하고 있다면, 컴포지터 스레드는 사용자가 스크롤할 때 콘텐츠가 스크롤되는 것처럼 사용자를 위한 것들을 처리하게 됩니다.

레이어들을 사용하는 것은 장점만 있는 것이 아니라 단점도 있습니다. 레이어들은 많은 메모리를 차지하고 실제로 작업을 더 느리게 만들 수 있습니다. 브라우저는 합당한 곳에서 레이어들의 결합을 필요로 하지만 그 장소를 알려주는 것은 어렵습니다.

즉, 페이지에서 서로 다른 것들이 많이 움직이면, 그냥 많은 레이어들로 끝날 수 있습니다. 이 레이어들은 메모리를 가득 채우며 컴포지터로 전송되는데 오랜 시간이 걸립니다.

## 핸들러의 동작

window에 scroll이벤트를 포함하여 이벤트 핸들러가 등록되는 경우, 핸들러의 동작은 컴포지터스레드가 받게 됩니다.


렌더링 되는 과정에서의 합성을 담당하는 브라우저의 컴포지터 스레드가 받게 됩니다. 즉! 

---

해당 내용은 다음 글을 참고 하였습니다.

- https://amati.io/eventlisteneroptions-passive-true/
- https://d2.naver.com/helloworld/5237120
- https://ui.toast.com/weekly-pick/ko_20171016/