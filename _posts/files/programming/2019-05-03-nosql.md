---
layout: post
title: NoSQL
categories: Programming
---

NoSQL 데이터베이스는 특정 데이터 모델에 대해 특정 목적에 맞추어 구축되는 데이터베이스로서 현대적인 애플리케이션 구축을 위한 유연한 스키마를 갖추고 있습니다. NoSQL 데이터베이스는 개발의 용이성, 기능성 및 확장성을 널리 인정받고 있습니다. 문서, 그래프, 키 값, 인 메모리, 검색을 포함해 다양한 데이터 모델을 사용합니다.

## NoSQL이란?

NoSQL은 SQL이 없는 데이터베이스구나! 라고 생각 할 수도 있겠지만, 진짜 의미는 `Not Only SQL`입니다. 이 말의 의미를 풀어보면, 단순히 기존 관계형 DBMS가 갖고 있는 특성뿐만 아니라, 다른 특성들을 부가적으로 지원한다는 것을 의미합니다. 즉 기존의 관계형 데이터베이스(RDBMS: Relational Database Management System)의 한계를 극복하기 위해 만들어진 새로운 형태의 데이터저장소입니다. 관계형 DB가 아니므로, RDMS처럼 고정된 스키마 및 JOIN 이 존재하지 않습니다. NoSQL 데이터베이스는 전통적인 RDMS보다 덜 제한적인 일관성 모델을 이용하는 데이터의 저장 및 검색을 위한 매커니즘을 제공합니다. 따라서 SQL의 관계형 데이터블로 서로 이루어진 것과는 달리 데이터 저장을 위한 메커니즘이 다릅니다. 구조화되지 않은, 방대한 데이터를 저장하기에 좋고 SQL과 같이 관계형 모델을 '모사'할 수도 있다는 장점이 있습니다.

## 역사

이 용어가 처음으로 등장한 것은 1998년 카를로 스트로찌(Carlo Strozzi)라는 엔지니어가 공개한 표준 SQL 인터페이스를 채용하지 않은 자신의 경량 Open Source 관계형 데이터베이스를 NoSQL이라고 명명한데서 유래했다고 합니다. 이후 2009년에는 요한 오스칼손(Johan Oskarsson)이라는 엔지니어가 Open Source기반의 분산 데이터베이스 관련 행사를 준비하면서 NoSQL이라는 용어를 사용했다고 합니다. 이때부터 기존의 관계형 데이터베이스 시스템의 주요 특성을 보장하는 ACID(Atomic, Consistency, Integrity, Duarabity) 특성을 제공하지 않는, 그렇지만 뛰어난 확장성이나 성능 등의 특성을 갖는 수많은 비관계형, 분산 데이터 베이스들이 등장했고 NoSQL이라는 용어가 보편적으로 사용되었습니다.

NoSQL이 등장한 이후에도 시장에서는 관계형 데이터베이스가 데이터를 처리하는데 가장 최적의 시스템으로 받아들이고 있었습니다.
특히 기업의 ERP나, MIS 시스템 등 데이터의 정확한 처리가 필수적인 시스템에서는 현재도 관계형 데이터베이스를 사용하고 있습니다. 또한 무엇보다도 SQL 이라고 하는 데이터를 처리하는 언어의 편이성 때문에 NoSQL 등 다른 데이터베이스 시스템들은 많이 활용 되지 않고 있었습니다.

그러나, 2000년 후반으로 넘어오면서 인터넷이 활성화되고, 소셜네트워크 서비스 등이 등장하면서 관계형 데이터 또는 정형데이터가 아닌 데이터, 즉 비정형데이터라는 것을 보다 쉽게 담아서 저장하고 처리할 수 있는 구조를 가진 데이터 베이스들이 관심을 받게 되었고, 해당 기술이 점점 더 발전하게 되면서, NoSQL 데이터베이스가 각광을 받게 된 것입니다. 이러한 배경하에서 어떤 엔지니어들은 NoSQL을 Modern web-scale databases라고 정의하기도 합니다.

## 특징

관계형 데이터베이스 보다 더 융통성 있는 데이터 모델을 사용하고, 데이터의 저장 및 검색을 위한 특화된 매커니즘을 제공합니다.
이를 통해 NoSQL 데이터베이스는 단순 검색 및 추가 작업에 있어서 매우 최적화된 키 값 저장 기법을 사용하여, 응답속도나, 처리 효율 등에 있어서 매우 뛰어난 성능을 나타냅니다. 이 특징들을 요약해보면 기존 관계형 데이터베이스와 다음과 같은 차이점을 보입니다.

- 스키마가 없다. 즉, 데이터 관계와 정해진 규격 ( table - column 의 정의 )이 없다.
- 관계형 모델을 사용하지 않으며 관계정의가 없으니 테이블간의 조인 기능 없음(reference와 같은 기능으로 비슷하게 구현은 가능)
- 트랜잭션을 지원하지 않는다.
- 분산처리 (수평적 확장)의 쉽게 제공한다. ( 대부분의 NoSQL DB는 분산처리기능을 목적으로 나왔기 때문에 분산처리 기능을 자체 프레임워크에 포함하고 있다 )
- 직접 프로그래밍을 하는 등의 비SQL 인터페이스를 통한 데이터 액세스
- 대부분 여러 대의 데이터베이스 서버를 묶어서(클러스터링) 하나의 데이터베이스를 구성
- 관계형 데이터베이스에서는 지원하는 Data처리 완결성(Transaction ACID 지원) 미보장
- 데이터의 스키마와 속성들을 다양하게 수용 및 동적 정의 (Schema-less)
- 데이터베이스의 중단 없는 서비스와 자동 복구 기능지원
- 다수가 Open Source로 제공
- 확장성, 가용성, 높은 성능

NoSQL은 유연한 DB Schema를 가지고 있습니다. 따라서 (스타트업과 같이) 짧은 시간 안에 DB 구조등이 자주 변하는 형태라면 적합할 수 있습니다. 유연하다는 말은, 자주 변하는 구조에서 시간이 흐르다 보면 데이터들의 구조가 어디는 살이 없고 어디는 있는, 뭔가 좀비와 같은 완전하지 않는 데이터들을 가지고 있게 될경우에도 사용가능함을 말합니다.

## 장점

NoSQL 데이터베이스는 탁월한 사용자 경험을 제공하기 위하여 유연성과 확장성을 비롯해 고성능의 매우 기능적인 데이터베이스를 필요로 하는 모바일, 웹이나 게이밍과 같은 다양한 현대적인 애플리케이션에 적합합니다.

### 유연성

NoSQL 데이터베이스는 일반적으로 유연한 스키마를 제공하여 보다 빠르고 반복적인 개발을 가능하게 해줍니다. 이같은 유연한 데이터 모델은 NoSQL 데이터베이스를 반정형 및 비정형 데이터에 이상적으로 만들어 줍니다.

### 확장성

NoSQL 데이터베이스는 일반적으로 고가의 강력한 서버를 추가하는 대신 분산형 하드웨어 클러스터를 이용해 확장하도록 설계되었습니다. 일부 클라우드 제공자들은 완전관리형 서비스로서 이런 운영 작업을 보이지 않게 처리합니다.

#### 참고) 서버 확장에서의 활용

서버 확장을 위한 두 가지 방법을호 스케일 아웃(Scale-Out)과 스케일 업(Scale-Up)이 존재 합니다. 보통은 스케일 아웃의 경우 서버의 대수를 늘려 처리 능력을 향상시키게 되는데 서버가 동일한 데이터를 가지고 있어야 하므로, 데이터 변화가 적은 웹 서버등에 적용하는 반면, 스케일 업(Scale-Up)은 서버의 성능을 확장하여 처리 능력을 향상시키는 것으로 보통은 한 대의 서버에서 모든 데이터를 처리하므로 데이터 갱신이 빈번하게 일어나는 데이터베이스 서버에 적합한 방식으로 사용됩니다.

그런데 NoSQL은 기존의 틀을 깨고 NoSQL의 경우 스케일 아웃(Scale-Out)의 형태로 증설을 할 수 있게 되는데, 고성능의 데이터베이스를 갖추는 게 아니라 여러 데이터베이스 시스템으로 추가할 수 있다는 말입니다. 서버의 숫자는 무한대로 늘려갈 수 있는데 이는 SQL의 스케일 업(Scale-Up)이 무제한적으로 늘려갈 수 없는 것과 비교해 장점이 될 수 있습니다.

- SQL의 경우 DB Schema를 한 번 정의하게 되면 데이터 및 구조의 완전성을 보장할 수 있지만 유연하진 않습니다. SQL은 금융 산업과 같이 시스템의 형태가 급격하게 자주 변하지 않는 보수적인 시스템에서 장점을 가질 수 있겠습니다.

### 고성능

NoSQL 데이터베이스는 특정 데이터 모델(문서, 키 값, 그래프 등) 및 액세스 패턴에 대해 최적화되어 관계형 데이터베이스를 통해 유사한 기능을 충족하려 할 때보다 뛰어난 성능을 얻게 해줍니다.

### 고기능성

NoSQL 데이터베이스는 각 데이터 모델에 맞추어 특별히 구축된 뛰어난 기능의 API와 데이터 유형을 제공합니다.

## 데이터 모델링에 따른 NoSQL의 구분

NoSQL은 다양한 종류의 데이터베이스가 존재합니다. 가장 기본이 되는 Key/Value Store와 Key/Value Store에서 컬럼 개념을 확장하여 생성된 Column Family, 문서 저장에 적합한 Document Store 그리고 네트워크 구조인 Graph 구조에 적용하는 Graph 데이터베이스가 있습니다. 각 데이터베이스별로 각각의 특성이 있고 사용 용도가 다릅니다. 저장되는 데이터의 구조(Data Model)에 따라 아래와 같이 나누어 볼 수 있습니다. 각 데이터 모델의 종류에 따라 다양한 시스템 특성의 차이가 있습니다.

- 키 값: 다이나모, 리악, 레디스, 캐시, 프로젝트 볼드모트
- 컬럼: H베이스, 아큐물로
- 도큐먼트: 몽고DB, 카우치베이스
- 그래프: Neo4J, AgensGraph, 알레그로그래프, 버투오소

### Key Value DB

NoSQL의 가장 기본적인 구조입니다. 여기서 store라고 하는 것은 DBMS가 아니라 단순히 데이터를 저장하는 store라는 의미에서 기존의 DBMS와의 다른 개념이고 일반적인 파일과 같이 저장하는 저장매체여서 단순히 store라고 이름을 붙였습니다. Key/Value Store는 단순히 key와 value만 갖습니다.

대표적으로 사용하는 Key/Value Store는 아마존 DynamoDB 같은 NoSQL입니다. DynamoDB는 테이블 생성을 아마존에서 제공하는 화면에서 직접생성합니다. Table Name과 Primary Key를 입력하고 테이블을 생성하는 절차를 거치면 원하는 테이블이 생성됩니다.

| Id (row key) | Other Attributes                                                                                                                                                                     |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 101          | { Title = "Book 101 Title" ISBN = "111-1111111111" Authors = "Author 1" Dimensions = "8.5 x 11.0 x 0.5" PageCount = 500 Inpublication = 1 ProductCategory = "Book"                   |
| 201          | { Title = "18-Bicycle 201" Description = "201 description" BicycleType = "Road" Brand = "Brand-Company A" Price = 100 Gender = "M" Coloe = ["Red", "Black"] ProductCategory = "Bike" |

### Wide Columnar Store(Column Family )

모델은 Key/Value 모델이 한단계 발전한 모델입니다. 관계형 데이터베이스에서는 테이블 생성시 칼럼이 정의되어 테이블이 생성되나 NoSQL에서는 테이블 생성시에는 테이블에 정의되지 않고 테이블에 데이터가 입력될 때 컬럼도 데이터로 테이블에 저장되는 개념입니다. 이 개념은 ER 모델에서도 갖고 있지 않은 개념입니다. 관계형 모델에서는 2레벨 구조적 속성관리가 불가능합니다. 하나의 테이블로 생성 시에는 모두 동일한 레벨에서 테이블이 생성됩니다. 이것을 구분하기 위해 일반적으로 컬럼명에 구분할 수 있게 명명규칙을 만들어 사용합니다.

NoSQL에서는 조인을 하지 않게 설계해야 하므로 하나의 테이블로 설계합니다. 다음은 사원 테이블을 NoSQL로 설계한 데이터 모델을 보여줍니다.

| 테이블명     | 사원                                     |
| ------------ | ---------------------------------------- |
| Row Key      | 사번                                     |
| CF: 공통사항 | 성명 주민번호                            |
| CE: 최종학력 | 학교명 전공 졸업년월일                   |
| CF: 전화번호 | 집전화번호 모바일전화번호 사무실전화번호 |

NoSQL에서는 위와 같이 간단히 구조적 모델이 해결됩니다. HBase에서는 Column Family라고 하는데 Cassandra에서는 슈퍼컬럼(Super Column)이라고 합니다. 모두 동일한 개념입니다. Cassandra에서는 테이블을 Column Family라고 합니다. NoSQL에서의 용어를 간단히 정리하면 다음과 같습니다.

1. 테이블
   관계형 모델의 테이블과 동일한 개념이다.

2. Row
   관계형 모델에서의 튜플(Tuple)에 해당하는 개념이다. 관계형 모델에서는 row 형태로 데이터베이스에 저장되지만 NoSQL 모델에서는 논리적으로 설계하기 위한 모델이고 실제 저장되는 단위는 아니다.

3. Column Family
   이미 설명했듯이 관계형 모델에서는 존재하지 않는 구조체 모델로 관계형 모델의 서브셋 개념과 유사하다. 관계형 모델에서는 한 테이블에서는 구분이 불가능하지만 NoSQL 모델에서는 특히 Column Family 모델에서는 이 모델이 지원된다.

4. Cell
   관계형 모델에서 한단계 더 내려간 개념이다. 관계형 모델에서는 집합론에서 튜플인 row 단위로 데이터베이스에 저장되므로 row까지 관리한다. 그러나 NoSQL 모델에서는 row를 컬럼 단위로 다시 분해해 저장하는데 일 value 단위를 cell이라고 한다.

| 속성  | 사번 | 성명   | 성별 | 학력 | 기혼여부 | 자녀수 |
| ----- | ---- | ------ | ---- | ---- | -------- | ------ |
| value | 1001 | 홍길동 | 남   | 무학 | 기혼     | 2      |
| value | 1004 | 김천사 | 여   | 대졸 | 미혼     |        |

관계형 모델에서는 한 줄씩 하나의 row로 저장됩니다. 즉 데이터가 row 단위로 관리됩니다. 이 모델을 Column Family 모델로 바꾸면 각 한줄이 cell이 됩니다.

| row key(사번) | Columns(컬럼명) | Value(값)      |
| ------------- | --------------- | -------------- |
| 1001          | 성명            | 홍 길동        |
| 1001          | 성별            | 남             |
| 1001          | 최종학교        | 하바드대학교   |
| 1004          | 성명            | 김 천사        |
| 1004          | 성별            | 여             |
| 1004          | 최종학교        | 옥스포드대학교 |

RDB와 HBase, Cassandra의 용어가 각각 다릅니다. 이를 정리하면 아래와 같습니다.

| 관계형 모델               | NoSQL(Hbase)     | NoSQL(Cassandra)   |
| ------------------------- | ---------------- | ------------------ |
| Database                  |                  | Keyspace           |
| Table                     | Data Store       | Column Family (CF) |
| Primary key               | Row Key          | Row Key            |
|                           | Column Family    | Super Column       |
| Column name               | Column Qualifier | Column Qualifier   |
| Column Value Column Value | Column value     |

일반적으로 Column Name은 NoSQL에서는 계속 반복되어 저장되므로 데이터의 용량이 커질 수 있습니다. 그래서 가급적이면 컬럼명은 알기 쉬운 범위에서 짧게 정의하기를 권합니다. 예를 들어 first name이면 f_name으로 column 명을 정의하고 last name이면 l_name으로 정의해 사용합니다. 설계자와 개발자는 동일한 개념으로 인식해야 합니다.

Big Table DB라고도 하며, Google의 BigTable Paper에서 유래되었습니다. Key Value 에서 발전된 형태의 Column Family 데이터 모델을 사용하고 있고, HBase, Cassandra, ScyllaDB 등이 이에 해당합니다.

### Document DB

Lotus Notes에서 유래되었으며, JSON, XML과 같은 Collection 데이터 모델 구조를 채택하고 있습니다. MongoDB, CoughDB가 이 종류에 해당합니다.

### Graph DB

Euler & Graph Theory에서 유래한 DB입니다. Nodes, Relationship, Key-Value 데이터 모델을 채용하고 있습니다. Neo4J, OreientDB 등의 제품이 있습니다.

## RDMS와 MongoDB의 비교

| RDBMS | MongoDB |
| ----- | ------- |


| Database Database
| Table | Collection |
| Tuple / Row | Document |
| Column | Key / Field |
| Table Join | Embedded Documents |
| Primary Key | Primary Key (\_id) |

| Database Server | Database Client |
| --------------- | --------------- |
| mysqld          | mongod          |
| mysql           | mongo           |

## NoSQL의 데이타 모델링 기법

---

해당 내용은 다음 글을 참고 하였습니다.

- https://ko.wikipedia.org/wiki/NoSQL
- https://brunch.co.kr/@kooslab/181
- https://velopert.com/436
- https://www.samsungsds.com/global/ko/support/insights/1195843_2284.html
