---
layout: post
title: 다양한 배포 방식
categories: Programming
---

서비스가 배포(deployment/release)되는 방법에는 여러가지 방식이 존재 합니다. 웹 서비스에서 많이 사용되는 방식을 소개하고자 합니다.

## 롤링 업데이트(rolling update / Ramped)

가장 일반적인 배포 방법으로 단순하게 서버 한대씩 배포를 진행합니다. 서버를 한 대씩 구 버전에서 새 버전으로 교체해가는 전략입니다. 구버전에서 새 버전으로 트래픽을 점진적으로 전환합니다. 만약 코드 변경에 따른 side effect가 발생하는 경우 롤백이 가능합니다. 또 관리가 편한 장점으로 많이 사용됩니다. 한 대씩만 배포되기 때문에 업데이트가 정상적으로 이루어졌는지에 대해 한대씩 살펴볼 수도 있습니다.

이와 같은 방식은 서버 수의 제약이 있을 경우 유용하나 배포 중 인스턴스의 수가 감소 되므로 서버 처리 용량을 미리 고려해야 합니다.

## 블루-그린(Blue-Green)

이전 배포물을 블루(blue), 신규 배포물을 그린(green)이라고 해서 붙여진 이름입니다. 새로운 배포물을 배포하고 모든 연결을 새로운 배포물만 보게 합니다. 구 버전에서 새 버전으로 트래픽을 일제히 전환하는 전략입니다. 코드 변경에 따른 side effect가 없습니다. 그러나 장애가 발생하는 경우 전체적으로 크게 영향을 받게 되는 단점이 있습니다.

## 카나리 (Canary)

카나리 배포는 옛날 광부들이 광산에 유독가스가 있는지 확인하기 위해 가스에 민감한 카나리아를 광산에 가지고 들어간 거에서 아이디어를 얻은 배포 방법입니다. 1대 또는 특정 user에게만 미리 배포했다가 잘되면 전체 배포하는 방식입니다. 수정한 코드가 워낙 많이 바뀌어서 좀 불안할 때 사용하는 방식입니다. 카나리아 새처럼 위험을 빠르게 감지할 수 있는 배포 기법입니다. 구 버전의 서버와 새 버전의 서버들을 구성하고 일부 트래픽을 새 버전으로 분산하여 오류 여부를 판단합니다. 이 기법으로 A/B 테스트도 가능한데, 오류율 및 성능 모니터링에 유용합니다. 트래픽을 분산시킬 라우팅은 랜덤으로 할 수도 있고 사용자 프로필 등을 기반으로 분류할 수도 있습니다. 분산 후 결과에 따라 새 버전이 운영 환경을 대체할 수도 있고, 다시 구 버전으로 돌아가 수도 있습니다.

## A/B 테스트

카나리 배포와 비슷하지만 이는 테스팅만을 위한 용도로 사용됩니다. 실제적 의미로 A/B 테스트(버킷 테스트 또는 분할-실행 테스트)는 두 개의 변형 A와 B를 사용하는 종합 대조 실험(controlled experiment)을 뜻합니다.

참고) 웹 사이트에서의 A/B 테스트 예제. 한 웹 사이트에서 한 개의 버튼 요소의 디자인만 다른 두 가지 버전을 무작위로 방문자에게 제공해, 두 디자인의 상대적인 효용성을 측정할 수 있다. 각 버전을 본 유저의 행동 데이터를 통계적으로 분석하여 특정한 변화를 주엇을때 목표를더 높게 달성하는지 알아낼 수 있다.

## 정리

롤링업데이트는 전체 배포 되어 있는 포드들을 한꺼번에 교체하는 것이 아니라 일정 개수씩 바꿔치기하면서 배포하는 방법으로 디플로이먼트의 기본 배포 방법입니다.

블루/그린은 기존에 띄워져 있는 포드 개수와 동일한 개수 만큼의 신규포드를 모두 띄운 다음에 신규 포드가 이상없이 정상적으로 떴는지 확인한 다음에 들어오는 트래픽을 한번에 신규포드쪽으로 옮기는 방법입니다.

카나리는 신규 버전을 배포할 때 한꺼번에 앱의 전체를 교체하는게 아니라 기존 버전을 유지한 채로 일부 버전만 신규 버전으로 올려서 신규 버전에 버그나 이상은 없는지를 사용자 반응은 어떤지 확인하는데 유용하게 사용하는 방법입니다.

---

해당 내용은 다음 글을 참고 하였습니다.

- https://knight76.tistory.com/entry/%EB%B0%B0%ED%8F%AC-%EB%B0%A9%EC%8B%9D-%EC%B9%B4%EB%82%98%EB%A6%AC%EB%B8%94%EB%A3%A8-%EA%B7%B8%EB%A6%B0%EB%A1%A4%EB%A7%81-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EB%B0%B0%ED%8F%AC-%EB%B0%A9%EC%8B%9D
- https://arisu1000.tistory.com/27842
- https://onlywis.tistory.com/10
