---
layout: post
title: 이벤트 성능 최적화를 위한 Throttle 와 Debounce
categories: JavaScript
---

수없이 많이 발생하는 이벤트로 비용이 많은 렌더링, 브라우저의 리플로우와 리페인트가 발생한다면 이는 결국 성능저하를 일으킬것입니다. 성능최적화를 위해! 이벤트를 조금 지연시키거나(Throttle), 모아서 한번에 처리(Debounce)하여 이벤트를 제한하는 방법들을 알아봅니다.

## 이벤트 성능 최적화

### 이벤트 성능 최적화가 필요한 스크롤 이벤트

DOM 이벤트를 기반으로 실행하는 자바스크립트를 성능상의 이유로 JS의 양적인 측면, 즉 이벤트(event)를 제어(제한)하는 방법입니다. 스크롤 이벤트의 경우, 스크롤링을 하게되면 사용자는 모르겠지만 내부적으로는 수많은 이벤트가 발생합니다. 사용자가 아래로 5000픽셀 정도의 스크롤 다운을 한다면 100 개 이상의 이벤트가 발생될 가능성이 큽니다. 이러한 스크롤(scroll wheel), 트랙패드, 스크롤 막대를 드래깅함으로써 매번 스크롤 이벤트에 대한 콜백(callback)이 발생하고 그 콜백이 수행하는 일이 매우 큰 리소스를 잡아먹게 될 것입니다.

### 이벤트 성능 최적화

과도한 이벤트 횟수의 실행으로 이벤트 핸들러가 무거운 계산 및 기타 DOM 조작과 같은 작업을 수없이 많이 수행하는 경우 성능 문제가 발생하고 이는 사용자 경험까지 떨어뜨리게 될 것입니다.

## Throttle 와 Debounce

이벤트 핸들러가 많은 연산(예: 무거운 계산 및 기타 DOM 조작)을 수행(이벤트 핸들러의 과도한 횟수가 발생하는 것)하는 경우에 대해 `제약`을 걸어 제어할 수 있는 수준으로 이벤트를 발생(그 핸들러를 더 적게 실행하면 빠져 나갈 수 있음)시키는 것을 목표로 하는 방법입니다. 디바운스(debounce)와 스로틀(throttle)은 시간이 지남에 따라 함수를 몇 번이나 실행 할지를 제어하는 유사한 기술이지만 서로 다릅니다.

- Throttle: 이벤트를 일정한 주기마다 발생하도록 하는 기술. 마지막 함수가 호출된 후 일정 시간이 지나기 전에 다시 호출되지 않도록 한다.
- Debounce: 이벤트를 그룹화하여 특정시간이 지난 후 하나의 이벤트만 발생하도록 하는 기술. 연이어 호출되는 함수들 중 마지막 함수(또는 제일 처음)만 호출하도록 한다. 이벤트를 위한 준비 및 콜백을 그룹화하여 절약하는 것이 목적이다.

## Throttle

Throttle 는 여러번 발생하는 이벤트를 일정 시간 동안, 한번만 실행됩니다. 특성 자체가 실행 횟수에 제한을 거는 것이기 때문에 일반적으로 성능 문제 때문에 많이 사용합니다. 스크롤을 올리거나 내릴 때 scroll 이벤트 핸들러 경우에 매우 많이 발생합니다. scroll 이벤트가 발생할 때 뭔가 복잡한 작업을 하도록 설정했다면 매우 빈번하게 실행되기 때문에 큰 버퍼링이 걸릴 지도 모를 것입니다. 그럴 때 쓰로틀링을 사용할 수 있습니다. 몇 초에 한 번, 또는 몇 밀리초에 한 번씩만 실행되게 제한을 두는 것입니다. Infinite scroll 구현시 응용합니다.

이벤트 발생 시간 이후에 일정 시간 동안 만을 기다리고, 이벤트를 실행 후 기다립니다. 한번만 실행 때문에, 잦은 이벤트 발생을 막아 성능상의 유리함을 가져 올 수 있습니다.

## Debounce

브라우저의 창 크기가 변경되는 것을 감지하는 resize이벤트의 경우, 브라우저의 창 크기가 변함에 따라 이벤트를 계속 발생시키지 않고 마지막 창 조정이 다 끝난 이후에만 이벤트가 발생되도록 합니다. 우리는 사용자가 브라우저 크기를 조정하지 않은 최종 값에만 관심이 있습니다. 사용자가 스크롤을 멈출 때만 이벤트를 발생시킵니다.

## 정리

Throttle 와 Debounce 는 자주 사용 되는 이벤트나 함수 들의 실행되는 빈도를 줄여서, 성능 상의 유리함을 가져오기 위한 개념입니다. 디바운싱과 스로틀의 가장 큰 차이점은 스로틀은 적어도 X 밀리 초마다 정기적으로 기능 실행을 보장한다는 것입니다. Debounce 는 아무리 많은 이벤트가 발생해도 모두 무시하고 특정 시간사이에 어떤 이벤트도 발생하지 않았을 때 딱 한번만 마지막 이벤트를 발생시키는 기법입니다. 따라서 5ms 가 지나기전에 계속 이벤트가 발생할 경우 콜백에 반응하는 이벤트는 발생하지 않고 계속 무시됩니다.

throttle함수와 debounce 함수의 치명적인 단점은 setTimeout을 기반으로 한 것으로 기대한 결과대로 동작하지 않을 수 있다는 것입니다. 왜냐하면, 싱글 스레드로 동작하는 Javascript 엔진은 setTimout의 비동기 API를 처리하기 위해 task queue에 쌓아서 하나씩 꺼내서 처리하게 되는데 이 과정에서 setTimout 또는 setInterval의 비동기 API가 제대로 trigger 되지 않을 수 있기 때문입니다.

- Debounce 는 입력이 끝날때까지 무한적으로 기다리지만, Throttle 는 입력이 시작되면, 일정 주기로 계속 실행한다.
- Debounce 의 시간을 짧게 가져간다면, Throttle 와 비슷한 효과가 날 수 있지만, 그럼에도 시점에서 차이가 날 수 있다.

---

해당 내용은 다음 글을 참고 하였습니다.

- https://webclub.tistory.com/607
- https://hyunseob.github.io/2016/04/24/throttle-and-debounce/
- https://medium.com/@pks2974/throttle-%EC%99%80-debounce-%EA%B0%9C%EB%85%90-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0-2335a9c426ff
- https://m.blog.naver.com/PostView.nhn?blogId=dndlab&logNo=221633637425&proxyReferer=https:%2F%2Fwww.google.com%2F
