---
layout: post
title: Test에서 Code Coverage란?
categories: Programming
---

소프트웨어의 사용이 많아지면서 소프트웨어의 품질을 향상하고 관리하기 위한 테스트의 중요성이 높아지고 있습니다. 여러 방법중 가장 잘 알려진 것이 '코드 커버리지' 입니다. Code Coverage란 프로그램의 소스 코드가 얼마만큼 테스트가 되었는가를 나타내는 지표를 의미 합니다. 테스트의 종류 중 구조 기반 테스트 유형에 속하며 구조기반 테스트는 화이트 박스라고도 불립니다. 구조기반 테스트는 소프트웨어나 시스템의 구조를 중심으로 테스팅 하는 기법으로, 보통 오픈소스 테스트 커버리지 툴이 많으면 Statement(구문), Decision(결정), Condition(조건) 세가지 커버리지를 기본적으로 측정합니다. 커버리지 측정 기준과 종류(유형)에 대해 알아 보겠습니다.

## 블랙박스 테스트와 화이트 박스 테스트

### 블랙박스 테스트(Black box test)
- 테스트 시 객체 내부에 무엇이 들어 있는지 알 수 없거나 알지 않아도 된다는 것을 가정하여 테스팅하는 방법.
- 객체 내부가 어떻게 변하던 상관없이 입력을 주었을때 원하는 결과값이 나오면 테스트는 통과하게 된다.

### 화이트박스 테스트(White box test)
- 객체 내부를 확인하고 검증하는 테스트이다.
- 쓰이지 않은 변수는 없는지..? 특정 범위만 받는 함수가 있는지..? 이런 부분을 확인하는 과정이다.
- 코드 커버리지(Code Coverage)는 화이트박스 테스트의 일부이다.

## 커버리지 측정 기준과 종류

### Statement Coverage (=Line Coverage)

구문 커버리지. 개발 소스의 각 라인이 수행되었는지를 확인하는 테스트 커버리지입니다. 테스트 스위트에 의해 실행된 구문이 몇 퍼센트인지 측정합니다. 다른 커버리지에 비해 가장 약합니다.

### Decision Coverage (=Branch Coverage)

결정 커버리지. 개발 소스의 각 분기문이 수행되었는지를 확인하는 테스트 커버리지입니다. 만약 소스에 if문이 있다고 했을 때 라인 커버리지는 true 조건 1가지에 대해서 커버리지 100%가 나올 수 있는 반면에, `브랜치 커버리지는 if문에 대해 true 조건 / false 조건 각각이 수행되어야 100% 달성`할 수 있습니다. 즉, 테스트 스위트에 의해 실행된 결정 포인트 내의 전체 조건식이 최소한 참(True)이 한번, 그리고 거짓(False)이 한번의 값을 갖는지 측정하여 퍼센트로 표현하는 것 입니다. 따라서 개별 조건식의 개수와 상관없이 테스트 케이스의 최소 개수는 2개가 존재하게 됩니다. 조건, 조건/결정 커버리지에 비해 약합니다.

### Condition Coverage (=Term Coverage)

조건 커버리지. 개발 소스의 각 분기문내에 존재하는 조건식을 확인하는 커버리지입니다. 전체 조건식의 결과와 관계없이 각 내부 개별 조건식이 true(참) 한번, flase(거짓) 한번을 모두 갖도록 개별 조건식을 조합하여 테스트 합니다. 최종 if문의 결과가 true였는지 false였는지를 따지지는 않으며, 같은 맥락에서 각 조건식 간의 조합에 대해서도 따지지 않습니다.

### C/D (Condition/Decision Coverage)

조건/결정 커버리지. 전체 조건식의 결과가 참 한번, 거짓 한번을 갖도록 각 개별 조건식을 조합하는데, 이때 각 개별 조건식도 참 한번, 거짓 한번을 모두 갖도록 개별 조건식을 조합하는 것으로 결정 커버리지와 조건 커버리지를 포함하는 커버리지입니다.

### MC/DC (Modified Condition/Decision Coverage)

변경조건/결정 커버리지. 원래는 M C/D C 로 보완된 조건/결정 커버리지입니다. Decision coverage, Condition coverage의 미흡점을 상호 보완하여 분기문의 조건문들이 모두 true/false 가 테스트 되도록 하면서 최종 if문의 결과도 true / fasle 각각이 테스트 되도록 하는 커버리지입니다. MC/DC가 측정되는 수준은 주로 특정 언어에 대한 상용툴 정도에서 커버가 됩니다.

### Path Coverage
각 if문간의 조합까지도 따지는 커버리지입니다. (첫번째 분기문 true - 두번째 분기문 false 같은)

## 예제
예를 들어 설명하겠습니다.
구문은 Line 수 7개 중 분기를 제외한 6과 같습니다.
조건은 line 4의 조건 "y<5" 의 참과 거짓, 2개입니다.
결정은 line 4의 결과 참과 거짓, 2개입니다.

만일, line 4의 조건식이 "y<5 && x <10"이라면
조건은 y에 대한 참과 거짓, x에 대한 참과 거짓으로 4개이고
결정은 조건식 전체에 대한 결과 참과 거짓으로 2개입니다.

```js
1 : int x = 3;
2 : int y = 0;
3 : y = x + 3;
4 : if( y<5 ) {
5 : x = 5;
6: }
7: else {
8 : x = 10;
9 : }
10 : y = 0;
```

## 정리

코드에 실행 가능한 단위 테스트가 존재하고 팀이 지속적으로 70%의 테스트 커버리지를 유지할 수 있다는 것은 팀과 코드의 상태 모두 양호하고 프로젝트의 가시성이 확보되었다는 것을 나타내주는 긍정적인 척도라고 할 수 있습니다. 주의할 점은, 테스트 커버리지에 대한 정책을 수립할 때, 테스트 커버리지에 대한 전반적인 이해 없이 맹목적으로 테스트 커버리지 수치만 강조할 경우 오히려 코드 전체의 품질이 저하될 위험이 있습니다. 70%의 라인 커버리지를 달성했다고 해서 70%의 코드 품질을 달성했다고 장담할 수는 없습니다. 따라서 정책적으로 무의미한 목표 커버리지를 강요할 경우 개발자가 취할 수 있는 마지막 방법은 코드의 품질을 보장하지는 않더라도 테스트 커버리지를 높일 수 있는 무가치한 테스트 케이스를 작성하는 것입니다. 라인 커버리지(Line Coverage)-또는 스테이트먼트 커버리지(Statement Coverage)라고도 한다-는 전체 코드 중 테스트에 의해 실행된 코드 라인 수의 비율을 의미합니다. 전체 100라인의 코드 중에서 테스트 케이스가 80 라인을 실행한 경우의 라인 커버리지는 80%가 됩니다. 

---

해당 내용은 다음 글을 참고 하였습니다.
- https://nesoy.github.io/articles/2018-01/Code-Coverage
- https://ko.wikipedia.org/wiki/%EC%BD%94%EB%93%9C_%EC%BB%A4%EB%B2%84%EB%A6%AC%EC%A7%80
- http://www.jidum.com/jidums/view.do?jidumId=565
- http://blog.naver.com/PostView.nhn?blogId=suresofttech&logNo=220842159146
